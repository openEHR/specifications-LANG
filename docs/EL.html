<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="openEHR Expression Language specification">
<meta name="keywords" content="openehr, expressions, rules">
<title>Expression Language (EL)</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_expression_language_el">Expression Language (EL)</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_supporters">Supporters</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_related_documents">1.2. Related Documents</a></li>
<li><a href="#_status">1.3. Status</a></li>
<li><a href="#_feedback">1.4. Feedback</a></li>
<li><a href="#_conformance">1.5. Conformance</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_requirements">2.1. Requirements</a></li>
<li><a href="#_design_background">2.2. Design Background</a></li>
<li><a href="#_execution_model">2.3. Execution Model</a></li>
</ul>
</li>
<li><a href="#_el_basics">3. EL Basics</a>
<ul class="sectlevel2">
<li><a href="#_syntax_style">3.1. Syntax style</a></li>
<li><a href="#_commenting">3.2. Commenting</a></li>
<li><a href="#_typing">3.3. Typing</a></li>
<li><a href="#_el_foundation_types">3.4. EL Foundation Types</a>
<ul class="sectlevel3">
<li><a href="#_primitive_types">3.4.1. Primitive Types</a></li>
<li><a href="#_container_types">3.4.2. Container Types</a></li>
<li><a href="#_interval_type">3.4.3. Interval Type</a></li>
<li><a href="#_complex_types">3.4.4. Complex Types</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_terminal_entities">4. Terminal Entities</a>
<ul class="sectlevel2">
<li><a href="#_literals">4.1. Literals</a></li>
<li><a href="#_variables">4.2. Variables</a>
<ul class="sectlevel3">
<li><a href="#_self">4.2.1. Self</a></li>
<li><a href="#_result">4.2.2. Result</a></li>
</ul>
</li>
<li><a href="#_type_references">4.3. Type References</a></li>
<li><a href="#_feature_references">4.4. Feature References</a>
<ul class="sectlevel3">
<li><a href="#_qualified_referencing">4.4.1. Qualified Referencing</a></li>
<li><a href="#_constants">4.4.2. Constants</a></li>
<li><a href="#_property_references">4.4.3. Property References</a></li>
<li><a href="#_function_calls">4.4.4. Function Calls</a></li>
<li><a href="#_built_in_functions">4.4.5. Built-in Functions</a></li>
<li><a href="#_container_item_access">4.4.6. Container Item Access</a></li>
<li><a href="#_matching_objects">4.4.7. Matching Objects</a></li>
</ul>
</li>
<li><a href="#_predicates">4.5. Predicates</a>
<ul class="sectlevel3">
<li><a href="#_attached_predicate">4.5.1. Attached() Predicate</a></li>
</ul>
</li>
<li><a href="#_agents">4.6. Agents</a></li>
</ul>
</li>
<li><a href="#_complex_expressions">5. Complex Expressions</a>
<ul class="sectlevel2">
<li><a href="#_equality_operator">5.1. Equality Operator</a></li>
<li><a href="#_primitive_operators">5.2. Primitive Operators</a>
<ul class="sectlevel3">
<li><a href="#_logical_negation">5.2.1. Logical Negation</a></li>
<li><a href="#_precedence_and_parentheses">5.2.2. Precedence and Parentheses</a></li>
</ul>
</li>
<li><a href="#_higher_order_operators">5.3. Higher-order Operators</a>
<ul class="sectlevel3">
<li><a href="#_quantification_operators">5.3.1. Quantification Operators</a></li>
</ul>
</li>
<li><a href="#_decision_tables">5.4. Decision Tables</a>
<ul class="sectlevel3">
<li><a href="#_condition_chain_ifthen">5.4.1. Condition Chain (if/then)</a></li>
<li><a href="#_case_table">5.4.2. Case Table</a></li>
<li><a href="#_nested_case_table">5.4.3. Nested Case Table</a></li>
<li><a href="#_multi_dimensional_case_table_experimental">5.4.4. Multi-dimensional Case Table (experimental)</a></li>
<li><a href="#_two_dimensional_tables_experimental">5.4.5. Two-dimensional Tables (experimental)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_syntax_specification">Appendix A: Syntax Specification</a></li>
<li><a href="#_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="https://specifications.openehr.org/images/openEHR_logo_RGB.svg" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_expression_language_el" class="sect0"><a class="anchor" href="#_expression_language_el"></a>Expression Language (EL)</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all fit-content spread">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification" target="_blank" rel="noopener">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: LANG latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: DEVELOPMENT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: openehr, expressions, rules</p></td>
</tr>
</tbody>
</table>
<div class="imageblock text-center">
<div class="content">
<object type="image/svg+xml" data="openehr_block_diagram.svg" width="60%"><span class="alt">openEHR components</span></object>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2020 - 2022 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="https://www.openehr.org" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit foundation, facilitating the sharing of health records by consumers and clinicians via open specifications, clinical models and open platform implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/LANG/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="https://specifications.openehr.org" target="_blank" rel="noopener">specifications.openEHR.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record"><a class="anchor" href="#_amendment_record"></a>Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser, Implementer</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>LANG Release 1.0.0</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>2.0.0</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a href="https://specifications.openehr.org/tickets/SPECLANG-1" target="_blank" rel="noopener">SPECLANG-1</a>. Add Expression Language specification.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>10 May 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Add Container selectors.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 May 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Update to be based on BMM <code>expression</code> package.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">03 Mar 2020</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Initial writing. Added external model use;<br>
 added <code>defined()</code> and <code>check()</code> predicates;<br>
 refined quantifiers;<br>
 added various kinds of binding;<br>
 change 'EL Text' to 'EL Module' in most cases.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19 Sep 2018</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author"><a class="anchor" href="#_primary_author"></a>Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Thomas Beale, Ars Semantica; openEHR Foundation Management Board.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_contributors"><a class="anchor" href="#_contributors"></a>Contributors</h3>
<div class="paragraph">
<p>This specification benefited from formal and informal input from the openEHR and wider health informatics community. The openEHR Foundation would like to recognise the following people for their contributions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pieter Bos, Senior Engineer, Nedap, Netherlands</p>
</li>
<li>
<p>Borut Fabjan, Program Manager, Better, Slovenia</p>
</li>
<li>
<p>Matija Kejžar, Senior Engineer, Better, Slovenia</p>
</li>
<li>
<p>Bostjan Lah, Architect, Better, Slovenia</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_supporters"><a class="anchor" href="#_supporters"></a>Supporters</h3>
<div class="paragraph">
<p>The work reported in this paper has been funded by the following organisations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>openEHR Foundation Industry and Organisation Partners</p>
</li>
<li>
<p>Ars Semantica, UK</p>
</li>
<li>
<p>Better, Slovenia (formerly Marand)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document specifies an abstract openEHR Expression Language (openEHR EL) that provides a syntax counterpart to the <code>expression</code> package in the <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR Basic Meta-Model (BMM)</a>. This may be used within BMM models, to specify archetype rules, <a href="https://specifications.openehr.org/releases/PROC/latest/task_planning.html" target="_blank" rel="noopener">Task Planning</a> expressions, in newer versions of <a href="https://specifications.openehr.org/releases/CDS/latest" target="_blank" rel="noopener">GDL</a>, and in decision language expressions.</p>
</div>
<div class="paragraph">
<p>The intended audience includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Standards bodies producing health informatics standards;</p>
</li>
<li>
<p>Academic groups using openEHR;</p>
</li>
<li>
<p>Solution vendors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_documents"><a class="anchor" href="#_related_documents"></a>1.2. Related Documents</h3>
<div class="paragraph">
<p>Prerequisite documents for reading this document include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html" target="_blank" rel="noopener">openEHR Architecture Overview</a>;</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR Basic Meta-Model (BMM)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Releated documents include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://specifications.openehr.org/releases/AM/latest/AOM2.html" target="_blank" rel="noopener">Archetype Object Model 2 (AOM2)</a>, Assertions section;</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/PROC/latest/task_planning.html" target="_blank" rel="noopener">Task Planning specification</a>;</p>
</li>
<li>
<p>The <a href="https://specifications.openehr.org/releases/CDS/latest/GDL.html" target="_blank" rel="noopener">Guideline Definition Language (GDL)</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.3. Status</h3>
<div class="paragraph">
<p>This specification is in the DEVELOPMENT state. The development version of this document can be found at <a href="https://specifications.openehr.org/releases/LANG/latest/expression_language.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/LANG/latest/expression_language.html</a>.</p>
</div>
<div class="paragraph">
<p>The expression language described in this specification is a more powerful language than the original <a href="https://specifications.openehr.org/releases/LANG/latest/basic_expression_language.html" target="_blank" rel="noopener">Basic Expression Language (BEL)</a>, and is based on the <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html#_expressions" target="_blank" rel="noopener">openEHR BMM expression model</a>. It is a major evolution on BEL syntax, and does not use the BEL meta-model.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.4. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="https://discourse.openehr.org/c/specifications/bmm-el" target="_blank" rel="noopener">openEHR languages specifications forum</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/LANG/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/LANG/history" target="_blank" rel="noopener">LANG component Change Request tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_conformance"><a class="anchor" href="#_conformance"></a>1.5. Conformance</h3>
<div class="paragraph">
<p>Conformance of a data or software artifact to an openEHR specification is determined by a formal test of that artifact against the relevant <a href="https://specifications.openehr.org/releases/ITS/latest/index" target="_blank" rel="noopener">openEHR Implementation Technology Specification(s) (ITSs)</a>, such as an IDL interface or an XML-schema. Since ITSs are formal derivations from underlying models, ITS conformance indicates model conformance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The openEHR Expression Language (EL) defines a syntax and grammar for the expressions whose meta-model is defined in the <code>expression</code> package in the <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR Basic Meta-Model (BMM)</a>. As such it may be considered the default syntax. Other syntaxes or syntaxes are certainly possible, and other expression serialisation are possible, such as object graph serialisation into XML, JSON, YAML etc. Consequently, the BMM <code>expression</code> package should be considered the normative definition of openEHR EL. Not all openEHR implementations using BMM expressions need support it: they might for example only serialse in JSON or use purely graphical visualisation.</p>
</div>
<div class="paragraph">
<p>Within openEHR, the uses of EL include expressing the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pre-, post-conditions and class invariants in BMM model definition files;</p>
</li>
<li>
<p>rules in archetypes;</p>
</li>
<li>
<p>rules in openEHR <a href="https://specifications.openehr.org/releases/CDS/latest/GDL2.html" target="_blank" rel="noopener">Guideline Definition Language (GDL)</a>;</p>
</li>
<li>
<p>expressions within decision logic models (DLMs) designed for use with openEHR <a href="https://specifications.openehr.org/releases/PROC/latest/task_planning.html" target="_blank" rel="noopener">Task Planning</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It may also be used in any other suitable context.</p>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>2.1. Requirements</h3>
<div class="paragraph">
<p>The semantic requirements including the usual arithmetic, boolean, and relational operators, functions, logical quantifiers, operator precedence, constant values, and variables. In addition, there is a need to support multi-lingual translations for symbolic variables, in a similar way to the <a href="https://specifications.openehr.org/releases/AM/latest/ADL2.html" target="_blank" rel="noopener">openEHR Archetype Definition Language (ADL2)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_design_background"><a class="anchor" href="#_design_background"></a>2.2. Design Background</h3>
<div class="paragraph">
<p>The openEHR Expression Language is based on a combination of first-order predicate logic, object-oriented structural concepts and functional computing. It has some similarities with <a href="https://www.omg.org/spec/OCL/" target="_blank" rel="noopener">OMG&#8217;s OCL (Object Constraint Language)</a>. It also draws on the semantics and some of the syntax (particularly agent-related) of the Eiffel Language (<a href="http://www.ecma-international.org/publications/standards/Ecma-367.htm" target="_blank" rel="noopener">ECMA-367</a>). See <a href="#Sowa2000">Sowa (2000)</a>, <a href="#Hein2002">Hein (2002)</a>, <a href="#Kilov1994">Kilov &amp; Ross (1994)</a> for an explanation of predicate logic in information modelling.</p>
</div>
<div class="paragraph">
<p>It is not exactly the same as any of these languages because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it has a different meta-model, namely the BMM <code>expression</code> meta-model;</p>
</li>
<li>
<p>the syntax is designed to be comprehensible to developers familiar with modern mainstream object-oriented and functional languages such as Java, C#, Python, TypeScript etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following the BMM meta-model, EL treats all classical operators as surface syntax for underlying functions available on types. Thus, the '+' operator in the expression <code>total + 1</code> is resolved to a function call on the type <code>Integer</code>: <code>total.add(1)</code>. In a similar way, higher-order operators ranging over collections of items (e.g. <code>for_all</code>) are resolved to calls to functions assumed to be defined on container types (e.g. <code>my_list.for_all(agent (v:T) )</code>)</p>
</div>
<div class="paragraph">
<p>Key features of EL include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>strong typing;</p>
</li>
<li>
<p>void-safety;</p>
</li>
<li>
<p>standard operators including:</p>
<div class="ulist">
<ul>
<li>
<p>logical operators including universal and existential quantification;</p>
</li>
<li>
<p>arithmetic and relational comparison operators, including for date/time types;</p>
</li>
<li>
<p>parentheses for overriding operator precedence;</p>
</li>
</ul>
</div>
</li>
<li>
<p>object-oriented qualification (dot notation);</p>
</li>
<li>
<p>decision structures, including:</p>
<div class="ulist">
<ul>
<li>
<p>binary choice operator (the so-called 'ternay operator' :? in C);</p>
</li>
<li>
<p>condition chains (if/then/else equivalent);</p>
</li>
<li>
<p>case tables;</p>
</li>
</ul>
</div>
</li>
<li>
<p>functions and agents (lambdas).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_execution_model"><a class="anchor" href="#_execution_model"></a>2.3. Execution Model</h3>
<div class="paragraph">
<p>The assumed execution model of the Expression language is that EL statements are evaluated by an <em>evaluator</em> against a <em>data context</em>, which determines the truth values of the expression(s). The data context is the origin for some or all of the variables mentioned in the expressions, which may be read from and written to. It may concretely be a retrieved data structure, or data via an API call to the EHR, demographics, laboratory system etc.</p>
</div>
<div class="paragraph">
<p>The data context may be specified in two ways. It may be inferrable from the artefact or computing context in which the EL statements appear, or it may be specified explicitly. In the former case, the EL instance is minimally a value-returning logical proposition such as <code>systolic_pressure &gt; 0</code>, where the declaration of variables or properties such as <code>systolic_pressure</code> are inferred from e.g. a data binding, and any manifest values obey this EL specification. The implicit case is shown below.</p>
</div>
<div id="EL_design_structure_implicit" class="imageblock text-center text-center">
<div class="content">
<img src="EL/diagrams/EL_design_structure-implicit.svg" alt="EL design structure implicit">
</div>
<div class="title">Figure 1. EL execution model - implicit context</div>
</div>
<div class="paragraph">
<p>In the explicit form, an EL expressions appear within a BMM model definition, or within a context that explicitly imports a BMM model.</p>
</div>
<div id="EL_design_structure_explicit" class="imageblock text-center text-center">
<div class="content">
<img src="EL/diagrams/EL_design_structure-explicit.svg" alt="EL design structure explicit">
</div>
<div class="title">Figure 2. EL execution model - explicit context</div>
</div>
<div class="paragraph">
<p>In both cases, the result of parsing into computable form for evaluation must result in instance of the BMM EL meta-types.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_el_basics"><a class="anchor" href="#_el_basics"></a>3. EL Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_syntax_style"><a class="anchor" href="#_syntax_style"></a>3.1. Syntax style</h3>
<div class="paragraph">
<p>The syntax style used in EL is inspired by elements of common languages available today, including TypeScript, Kotlin, Java, etc, with divergences to provide a syntax that is more easily readable to non-IT professionals as well as IT professionals.</p>
</div>
<div class="paragraph">
<p>The lexical style used in EL is a form of so-called 'snake_case' rather than so-called 'CamelCase', in common with other openEHR specifications, but either may be used in real applications. One reason for using snake-case is be to render EL Modules more readable to the non-IT professional. Upper- and lower-case are not formally distinguished, and the use of upper case is a matter of style only, as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>class names</em>: upper-case first letter followed by alphanumerics with underscores where spaces would occur in natural language, e.g. <code>Iso8601_date_time</code>, <code>Arrayed_list&lt;T&gt;</code>;</p>
</li>
<li>
<p><em>property, routine and variable names</em>: lower-case first letter, followed by alphanumerics with underscores, e.g. <code><em>employee_group</em></code>, <code><em>average_pressure</em>()</code>;</p>
</li>
<li>
<p><em>constants and class (static) functions</em>: upper-case first letter, followed by alphanumerics with underscores, e.g. <code>Maximum_speed</code>.</p>
</li>
</ul>
</div>
<div class="paragraph tbd">
<p>TBD: specify equivalence between snake-case and CamelCase, or a tool-level switch?</p>
</div>
</div>
<div class="sect2">
<h3 id="_commenting"><a class="anchor" href="#_commenting"></a>3.2. Commenting</h3>
<div class="paragraph">
<p>Comments are of two styles. For end-of-line commenting, and for creating visual dividing lines, the leader pattern <code>'--'</code> is used. Dividing lines are a longer line (more than three characters), e.g <code>'---------'</code> or a line of (four or more) <code>'='</code> symbols, i.e. <code>'========'</code>. The latter is useful for multi-level decision tables.</p>
</div>
<div class="paragraph">
<p>Comment-only lines start with the bar character (<code>'|'</code>). The example below shows both forms.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    |
    | patient fit to undertake regime
    |
    patient_fit:
        Result := not
            (platelets.in_range ([very_low]) or  -- platelets can't be too low
             neutrophils.in_range ([very_low]))</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_typing"><a class="anchor" href="#_typing"></a>3.3. Typing</h3>
<div class="paragraph">
<p>EL is fully typed, with type definitions being supplied by one or more models, represented in the form of <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR BMM specification</a>. <strong>All operators are assumed to be implemented by and to map to functions defined on types</strong>, including operators such as '+' mapping to the function <code>add()</code> defined on primitive types such as <code>Integer</code>. Accordingly, such operators are defined within the BMM as being operator <em>aliases</em> of their implementing function, which is made possible by the BMM meta-types <code>BMM_ROUTINE</code> and descendants.</p>
</div>
<div class="paragraph">
<p>An important implementation consequence of this approach is that an expression that is parsed to a classic operator-based AST may be evaluated by progressively searching for operator-aliased functions within the model definition, invoking with the arguments found in the AST structure, and returning Results for the next such computation. Of course, use of built-in native types and functions  (rather than always dispatching via a BMM) to handle primitive type operators is likely to be used in the interests of efficiency. Function-matching can be implemented by matching the inferred signature of the operator and its argument(s) with functions having both a conformant (not necessarily identical) signature, and the same operator.</p>
</div>
<div class="paragraph">
<p>Such model definitions will therefore include primitive type definitions, either the openEHR <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html" target="_blank" rel="noopener">Foundation Types</a>, i.e. primitive types, container types and interval types, or ones that correspond very closely. In the interests of completeness, EL <em>assumes</em> the openEHR Foundation Types, so as to have a minimal basis.</p>
</div>
</div>
<div class="sect2">
<h3 id="_el_foundation_types"><a class="anchor" href="#_el_foundation_types"></a>3.4. EL Foundation Types</h3>
<div class="paragraph">
<p>The EL syntax for these is described below.</p>
</div>
<div class="sect3">
<h4 id="_primitive_types"><a class="anchor" href="#_primitive_types"></a>3.4.1. Primitive Types</h4>
<div class="paragraph">
<p>The EL primitive types are shown below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large integer value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Real</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Real value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large real value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Date_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format date/time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uri in <a href="https://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener">IETF RFC 3986</a> format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Terminology_code</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terminology code reference</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Automatic type promotion from <code>Integer</code> to <code>Real</code> applies to mixed integer / real values and expressions, in the same fashion as most programming languages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_container_types"><a class="anchor" href="#_container_types"></a>3.4.2. Container Types</h4>
<div class="paragraph">
<p>The same container types as defined in the <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html#_structure_types" target="_blank" rel="noopener">Foundation Types, <code>structure</code> package</a> are assumed in EL, under the following names.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Container&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract parent of <code>List</code>, <code>Set</code> and <code>Map</code> types</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linear list of items of any primitive type, allowing order and repeated membership</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Set&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set of items of any primitive type; no order, unique membership</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map&lt;K:Ordered, V&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indexed linear container</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_interval_type"><a class="anchor" href="#_interval_type"></a>3.4.3. Interval Type</h4>
<div class="paragraph">
<p>The same <code>Interval</code> type as defined in the <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html#_interval" target="_blank" rel="noopener">Foundation Types, <code>interval</code> package</a> is assumed in EL, under the following names.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Interval&lt;T:Ordered&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval of any ordered type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Point_interval&lt;T:Ordered&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sub-type used to efficiently represent closed intervals whose boundaries are the same</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Proper_interval&lt;T:Ordered&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sub-type used to efficiently represent intervals whose boundaries are different</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Automatic type promotion from <code>Interval&lt;Integer&gt;</code> to <code>Interval&lt;Real&gt;</code> applies to all integer and real values and expressions, in the same fashion as most programming languages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_complex_types"><a class="anchor" href="#_complex_types"></a>3.4.4. Complex Types</h4>
<div class="paragraph">
<p>Complex types are imported from a formal model definition, expressed in <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html" target="_blank" rel="noopener">openEHR BMM format</a>, or any formal equivalent. The types in a model definition included in this way become available within the formalism in the same way as the foundation types, and may be used in expressions in the same way.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_terminal_entities"><a class="anchor" href="#_terminal_entities"></a>4. Terminal Entities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Terminal entities in EL correspond to the <code>EL_TERMINAL</code> meta-type in BMM, and its descendants. These come in three categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>instance references</em>: references to instances generated by direct references to <em>literals</em>, <em>constants</em>, <em>variables</em>, or else <em>function calls</em>;</p>
</li>
<li>
<p><em>predicates</em>: logical conditions on instance references;</p>
</li>
<li>
<p><em>agents</em>: delayed routine call objects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following sub-sections describe these types.</p>
</div>
<div class="sect2">
<h3 id="_literals"><a class="anchor" href="#_literals"></a>4.1. Literals</h3>
<div class="paragraph">
<p>Literal values are mostly instances of the types declared in the imported models. Assumed literals correspond to the openEHR Foundation and Based types, and are expressed in the <a href="https://specifications.openehr.org/releases/LANG/latest/odin.html#_primitive_types" target="_blank" rel="noopener">openEHR ODIN syntax</a>, with the exception of <code>List&lt;T&gt;</code>, <code>Set&lt;T&gt;</code> and <code>Map&lt;K,V&gt;</code>, which are distinguished in EL with specific types of brackets. The corresponding classes are described in the <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html" target="_blank" rel="noopener">openEHR Foundation Types specification</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Literal values</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>True</code>, <code>False</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code>, <code>-4</code>, <code>5e09</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed integer values from −2<sup>31</sup> to 2<sup>31</sup>-1, including E-notation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Real</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10.0</code>, <code>0.345</code>, <code>22.5%</code>, <code>6.023e23</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signed real values from 3.4028235 × 10<sup>38</sup>, including percentages and E-notation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Double</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10.0</code>, <code>0.345</code>, <code>22.5%</code>, <code>6.023e23</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double precision real values, including percentages and E-notation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2004-08-12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Date_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2004-08-12T12:00:59+0100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format date/time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12:00:59</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>P2Y8M</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISO 8601-format duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"this is a string"</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;https://en.wikipedia.org&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uri in <a href="https://tools.ietf.org/html/rfc3986" target="_blank" rel="noopener">IETF RFC 3986</a> format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Terminology_code</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#identifier</code><br>
                         <code>#snomed_ct::389086002</code><br>
                         <code>#snomed_ct::389086002|Hypoxia|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local terminology code<br>
                                                                 Terminology code in openEHR format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Array&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[val, val, &#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(val, val, &#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Set&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{val, val, &#8230;&#8203;}</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map&lt;K, V&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>{
    prim_val : val,
    prim_val : val,
    ...
    prim_val : val
}</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A table of values of any type V,<br>
                                                                 keyed by primitive values, typically <code>String</code>,<br>
                                                                 <code>Integer</code> or Date/time types.<br>
                                                                 <code>&lt;val&gt;</code> are literals of any other type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object</p></td>
<td class="tableblock halign-left valign-top"><div class="literal"><pre>{
    identifier : val,
    identifier : val,
    ...
    identifier : val
}</pre></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object of any type T,<br>
                                                                 whose property names are <code>identifier</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Interval&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|N..M|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the two-sided interval N ≥ x ≤ M</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|&gt;N..M|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the two-sided interval N &gt; x ≤ M</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|N..&lt;M|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the two-sided interval N ≥ x &lt; M</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|&lt;N|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the one-sided interval x &lt; N</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|&gt;N|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the one-sided interval x &gt; N</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|&lt;=N|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the one-sided interval x ≤ N</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|&gt;=N|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the one-sided interval x ≥ N</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|N +/-M|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the two-sided interval of N ±M</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|N±M|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the two-sided interval of N ±M</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>One exception to the above is tuples, which are direct instances of the BMM meta-type <code>BMM_TUPLE</code>. They take the literal form <code>[a, b, c]</code>, where <code>a</code>, <code>b</code>, and <code>c</code> are generally of different types.</p>
</div>
<div class="paragraph tbd">
<p>TBD: consider to not bother with <code>Array</code> and reserve <code>[]</code> for tuples.</p>
</div>
</div>
<div class="sect2">
<h3 id="_variables"><a class="anchor" href="#_variables"></a>4.2. Variables</h3>
<div class="paragraph">
<p>Symbolic variables are valid within the scope of the routine in which they are declared, and are classified as read-only or writable. Read-only variables include routine parameters and the automatically declared variable <code>Self</code>, and are reprsented by the meta-type <code>EL_READONLY_VARIABLE</code>.</p>
</div>
<div class="paragraph">
<p>Writable variables include locally declared variables and the automatically declared variable <code>Result</code> and are represented by the BMM meta-type <code>EL_WRITABLE_VARIABLE</code>.</p>
</div>
<div class="sect3">
<h4 id="_self"><a class="anchor" href="#_self"></a>4.2.1. Self</h4>
<div class="paragraph">
<p>As with many programming languages, a pre-defined read-only reference to the current object is available via the plain name <code>Self</code>. Unlike some languages, 'Self' is not needed as a qualifier for properties or functions, and is generally only used as an argument in function calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="_result"><a class="anchor" href="#_result"></a>4.2.2. Result</h4>
<div class="paragraph">
<p>In EL, the variable <code>Result</code> is automatically declared on entry to any function to be of the return type of the function. It is a writable variable and the function will return whatever value has been assigned to <code>Result</code> during execution.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_type_references"><a class="anchor" href="#_type_references"></a>4.3. Type References</h3>
<div class="paragraph">
<p>A type may be directly referenced using the syntax <code>{TypeName}</code>. This has the effect of creating an anonymous variable whose value is a read-only instance of the type. This may be equivalently understood as the 'static view'. A type reference can be the scoper of any feature call that is to read-only and is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a static feature, i.e. a constant or class singleton;</p>
</li>
<li>
<p>any function that depends recursively only on constants and static features in addition to any arguments.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This provides a mechanism, common to many programming languages, for access to constants and helper functions without creating instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feature_references"><a class="anchor" href="#_feature_references"></a>4.4. Feature References</h3>
<div class="sect3">
<h4 id="_qualified_referencing"><a class="anchor" href="#_qualified_referencing"></a>4.4.1. Qualified Referencing</h4>
<div class="paragraph">
<p>Any feature reference may appear as itself (in the relevant syntactic form described below) or in a form qualified by scoping entities, using standard 'dot' referencing. The qualifier provides the reference context, and is represented by the <code>EL_FEATURE_REF</code> property <code><em>scoper</em></code>. Multiple qualifiers may be used in a single reference, as long as class feature visibility is satisfied, allowing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">person1</span><span class="tok-p">.</span><span class="tok-n">name</span>
    <span class="tok-n">employees</span><span class="tok-p">[</span><span class="tok-m">1</span><span class="tok-p">].</span><span class="tok-n">name</span><span class="tok-p">.</span><span class="tok-n">first_name</span>
    <span class="tok-n">blood_pressure</span><span class="tok-p">.</span><span class="tok-n">history</span><span class="tok-p">.</span><span class="tok-n">events</span><span class="tok-p">[</span><span class="tok-m">3</span><span class="tok-p">].</span><span class="tok-k">data</span><span class="tok-p">.</span><span class="tok-k">data</span><span class="tok-p">.</span><span class="tok-n">systolic</span>

    <span class="tok-n">agent</span> <span class="tok-n">obstetric_risks</span><span class="tok-p">.</span><span class="tok-n">basic_risk</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_constants"><a class="anchor" href="#_constants"></a>4.4.2. Constants</h4>
<div class="paragraph">
<p>Constants are syntactically represented using labels of which the first letter is capitalised, and may be of any type, including complex types. The following are EL expressions containing constants.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">Mph_to_kmh_factor</span> <span class="tok-p">=</span> <span class="tok-m">1.6</span>
    <span class="tok-n">Safe_glucose_limits</span><span class="tok-p">.</span><span class="tok-n">has</span> <span class="tok-p">(</span><span class="tok-m">3.5</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_property_references"><a class="anchor" href="#_property_references"></a>4.4.3. Property References</h4>
<div class="paragraph">
<p>Property references are valid within the scope of the class in which they are declared, and may be used in any routine definition or assertion in the class. They are represented by plain names such as <code>diabetic_status</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_function_calls"><a class="anchor" href="#_function_calls"></a>4.4.4. Function Calls</h4>
<div class="paragraph">
<p>In EL expressions, computational functions may be called in the same way as for typical programming languages. An EL property reference corresponds to the BMM meta-type <code>EL_FUNCTION_CALL</code>, which contains an instance of the BMM meta-type <code>EL_FUNCTION_AGENT</code>, which in turn has as its <code><em>closed_args</em></code> a tuple containing a set of items each of which is in turn an expression of any kind.</p>
</div>
<div class="paragraph">
<p>Consequently, EL function calls (similarly to most programming languages) may be of any level of complexity. The simplest type of function call is to a function whose signature is <code>&lt;[],T&gt;</code>, i.e. one taking no arguments are returning a value of type <code>T</code>. In EL, this may be called with or without parentheses, e.g. <code>age</code> or <code>age()</code>.</p>
</div>
<div class="paragraph">
<p>The following example assumes a function <code>tnm_major_number (tnm_val: String): Integer</code> that extracts various elements of <a href="https://en.wikipedia.org/wiki/TNM_staging_system" target="_blank" rel="noopener">Tumour/Node/Metastasis ('TNM')</a> cancer staging values, such as <code>'Tis'</code>, <code>'G3'</code> and so on, and shows two forms of call to this function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">tnm_major_number</span> <span class="tok-p">(</span><span class="tok-n">tnm_t</span><span class="tok-p">)</span>
    <span class="tok-n">tnm_major_number</span> <span class="tok-p">(</span><span class="tok-s">&quot;Tis&quot;</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>More complex function calls may include arguments of other function calls, agents, tuples, operator expressions and normal instance references.</p>
</div>
<div class="paragraph">
<p>To be evaluated, function calls must be mappable to class methods in external libraries that are available at expression evaluation time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_built_in_functions"><a class="anchor" href="#_built_in_functions"></a>4.4.5. Built-in Functions</h4>
<div class="paragraph">
<p>Some commonly used functions such as <code>current_date()</code> or similar are often thought of as 'built-in' to a language environment. In the openEHR EL context, there are no built-in functions as such; useful utility functions must be supplied by classes or interfaces included as part of an imported model. In the openEHR environment, many utility calls are available in the <a href="https://specifications.openehr.org/releases/BASE/latest/base_types.html" target="_blank" rel="noopener">openEHR Base Types</a>. They will resolve correctly as long as this model is imported, which it normally will be as part of a larger model, such as the <a href="https://specifications.openehr.org/releases/RM/latest/index" target="_blank" rel="noopener">openEHR RM</a>.</p>
</div>
<div class="paragraph">
<p>As a consequence, the total set of available utility functions for use in an EL expression is just what is available from the sum of all imported models. Assuming the openEHR Foundation and Base Types, the following kinds of functions are available for use in EL expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-p">{</span><span class="tok-n">Env</span><span class="tok-p">}.</span><span class="tok-n">current_date</span>                                <span class="tok-p">--</span> <span class="tok-n">obtain</span> <span class="tok-n">today</span><span class="tok-err">&#39;</span><span class="tok-n">s</span> <span class="tok-n">date</span> <span class="tok-k">as</span> <span class="tok-n">a</span> <span class="tok-n">Iso8601_date</span>

    <span class="tok-n">blood_glucose_list</span><span class="tok-p">:</span> <span class="tok-n">List</span><span class="tok-p">&lt;</span><span class="tok-n">Real</span><span class="tok-p">&gt;</span>
    <span class="tok-p">{</span><span class="tok-n">Statistical_evaluator</span><span class="tok-p">}.</span><span class="tok-n">max</span> <span class="tok-p">(</span><span class="tok-n">blood_glucose_list</span><span class="tok-p">)</span>  <span class="tok-p">--</span> <span class="tok-n">compute</span> <span class="tok-n">a</span> <span class="tok-n">maximum</span> <span class="tok-n">of</span> <span class="tok-n">Numerics</span>

    <span class="tok-p">{</span><span class="tok-n">Locale</span><span class="tok-p">}.</span><span class="tok-n">language</span>                                 <span class="tok-p">--</span> <span class="tok-n">the</span> <span class="tok-n">primary</span> <span class="tok-n">language</span> <span class="tok-k">in</span> <span class="tok-n">the</span> <span class="tok-n">locale</span> <span class="tok-k">as</span> <span class="tok-n">a</span> <span class="tok-n">Coded_term</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_container_item_access"><a class="anchor" href="#_container_item_access"></a>4.4.6. Container Item Access</h4>
<div class="paragraph">
<p>Access to members of instances of a container type may be achieved by normal functional means (typically functions like <code>Array&lt;T&gt;.get()</code> or <code>List&lt;T&gt;.item()</code>), and also via the <code>[]</code> operator, which is an alias for such functions defined on the relevant types, as follows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Array&lt;T&gt;.item(i: Integer): T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-th element of an array; 1-based</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>List&lt;T&gt;.item(i: Integer): T</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-th element of a list; 1-based</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[k]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Map&lt;K,V&gt;.item(k: K): V</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">element at key k of a Map</p></td>
</tr>
</tbody>
</table>
<div class="paragraph tbd">
<p>TBD: to achieve this generically, the above map of operators to member functions of appropriate types needs to be supplied in the model supplying the types themselves.</p>
</div>
<div class="paragraph">
<p>Container element access may be used on any expression whose effective type is a container, including function calls.</p>
</div>
</div>
<div class="sect3">
<h4 id="_matching_objects"><a class="anchor" href="#_matching_objects"></a>4.4.7. Matching Objects</h4>
<div class="paragraph">
<p>Matching of objects is possible via use of predicates using the <code>[]</code> syntax used after any variable or feature reference. This is achieved by supplying an agent argument whose signature is <code>&lt;[T], Boolean&gt;</code>, or in functional form, <code>(v:T): Boolean</code>. For non-container objects, the type <code>T</code> is the statically declared type of the object. If the object is of a container type (list, array etc) then the type <code>T</code> is the type of the container <em>items</em>.</p>
</div>
<div class="paragraph">
<p>The <code>[]</code> syntax is shorthand for the following assumed functions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Any</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match (matcher: &lt;T&gt; Function &lt;[T], Boolean&gt;): T</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Container&lt;T&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>match (matcher: Function &lt;[T], Boolean&gt;): List&lt;T&gt;</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph tbd">
<p>TBD: For <code>Any</code>, need type anchoring&#8230;&#8203; or else generic functions.</p>
</div>
<div class="paragraph">
<p>Here, 'matching' is understood to mean <em>obtain all matching items</em>.</p>
</div>
<div class="paragraph">
<p>This enables a reference of the following form to be constructed (final line).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-k">class</span> <span class="tok-nc">Book</span> <span class="tok-p">{</span>
        <span class="tok-n">title</span><span class="tok-p">:</span> <span class="tok-n">String</span><span class="tok-p">;</span>
        <span class="tok-n">pub_date</span><span class="tok-p">:</span> <span class="tok-n">Date</span><span class="tok-p">;</span>
        <span class="tok-n">country</span><span class="tok-p">:</span> <span class="tok-n">Terminology_code</span><span class="tok-p">;</span>
    <span class="tok-p">}</span>

    <span class="tok-n">book_list</span><span class="tok-p">,</span> <span class="tok-n">old_spanish_books</span><span class="tok-p">:</span> <span class="tok-n">List</span><span class="tok-p">&lt;</span><span class="tok-n">Book</span><span class="tok-p">&gt;</span>

    <span class="tok-n">old_spanish_books</span> <span class="tok-p">:=</span> <span class="tok-n">book_list</span> <span class="tok-p">[(</span><span class="tok-n">b</span><span class="tok-p">:</span><span class="tok-n">Book</span><span class="tok-p">)</span> <span class="tok-p">{</span><span class="tok-n">b</span><span class="tok-p">.</span><span class="tok-n">title</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;Quixote&quot;</span><span class="tok-p">)}]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The part in <code>{}</code> is any Boolean-valued expression, and may therefore be an operator expression, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">old_spanish_books</span> <span class="tok-p">:=</span> <span class="tok-n">book_list</span> <span class="tok-p">[(</span><span class="tok-n">b</span><span class="tok-p">:</span><span class="tok-n">Book</span><span class="tok-p">)</span> <span class="tok-p">{</span><span class="tok-n">b</span><span class="tok-p">.</span><span class="tok-n">title</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;Quixote&quot;</span><span class="tok-p">)</span> <span class="tok-n">OR</span> <span class="tok-n">b</span><span class="tok-p">.</span><span class="tok-n">pub_date</span> <span class="tok-p">&lt;</span> <span class="tok-n">P1650Y</span> <span class="tok-n">AND</span> <span class="tok-n">b</span><span class="tok-p">.</span><span class="tok-n">country</span> <span class="tok-p">=</span> <span class="tok-err">#</span><span class="tok-n">iso639</span><span class="tok-o">::</span><span class="tok-n">es</span><span class="tok-p">}]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since the function signature is invariant with respect to the container item type (here, <code>Book</code>), a shorter form can be used in which the <code>b</code> is assumed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">old_spanish_books</span> <span class="tok-p">:=</span> <span class="tok-n">book_list</span> <span class="tok-p">[</span><span class="tok-n">title</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;Quixote&quot;</span><span class="tok-p">)</span> <span class="tok-n">OR</span> <span class="tok-n">pub_date</span> <span class="tok-p">&lt;</span> <span class="tok-n">P1650Y</span> <span class="tok-n">AND</span> <span class="tok-n">country</span> <span class="tok-p">=</span> <span class="tok-err">#</span><span class="tok-n">iso639</span><span class="tok-o">::</span><span class="tok-n">es</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above, the variable <code>old_spanish_books</code> is of type <code>List&lt;Book&gt;</code>, and in general may contain more than one item (as well as be empty). To obtain the first book in the list, the standard array reference syntax may be used, i.e. <code>old_spanish_books[1]</code>. By extension, the following is also legal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">old_spanish_book</span><span class="tok-p">:</span> <span class="tok-n">Book</span>

    <span class="tok-n">old_spanish_book</span> <span class="tok-p">:=</span> <span class="tok-n">book_list</span> <span class="tok-p">[</span><span class="tok-n">title</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;Quixote&quot;</span><span class="tok-p">)</span> <span class="tok-n">OR</span> <span class="tok-n">pub_date</span> <span class="tok-p">&lt;</span> <span class="tok-n">P1650Y</span> <span class="tok-n">AND</span> <span class="tok-n">country</span> <span class="tok-p">=</span> <span class="tok-err">#</span><span class="tok-n">iso639</span><span class="tok-o">::</span><span class="tok-n">es</span><span class="tok-p">][</span><span class="tok-m">1</span><span class="tok-p">]</span> <span class="tok-p">--</span> <span class="tok-n">safe</span> <span class="tok-k">if</span> <span class="tok-n">it</span> <span class="tok-k">is</span> <span class="tok-n">known</span> <span class="tok-n">that</span> <span class="tok-n">there</span> <span class="tok-k">is</span> <span class="tok-n">at</span> <span class="tok-n">least</span> <span class="tok-n">one</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Operator expressions based on the types of the items in the container may be used. The following predicate uses the short form of the expression <code>b.pub_date &gt;= PY2003</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">book_list</span> <span class="tok-p">[</span><span class="tok-n">pub_date</span> <span class="tok-p">&gt;=</span> <span class="tok-n">PY2003</span><span class="tok-p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Qualified referencing can be combined with selector agents to obtain an effect similar to the use of Xpath on XML data, as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">book_list</span> <span class="tok-p">[</span><span class="tok-n">title</span><span class="tok-p">.</span><span class="tok-n">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;Quixote&quot;</span><span class="tok-p">)][</span><span class="tok-m">1</span><span class="tok-p">].</span><span class="tok-n">pub_date</span><span class="tok-p">.</span><span class="tok-n">year</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For matching to work, there must be an appropriate function available on all container types. In the case of the openEHR Foundation types, this is <code>match (&lt;[T], Boolean&gt;): List&lt;T&gt;</code> defined on <code>Container&lt;T&gt;</code>; any equivalent function in a different model will do. The return type is nullable.</p>
</div>
<div class="paragraph tbd">
<p>TBD: to achieve this generically, the map of operators to member functions of appropriate types needs to be supplied in the model supplying the types themselves.</p>
</div>
<div class="paragraph">
<p>Other short forms are available, making a predicate syntax reminiscent of Xpath possible, as follows.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Lambda expression</th>
<th class="tableblock halign-left valign-top">Short form</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object[(v:T) {expr using v}]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object[expr with implied v]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>container[(v:T) {expr using v}]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>object[expr with implied v]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(more)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_predicates"><a class="anchor" href="#_predicates"></a>4.5. Predicates</h3>
<div class="paragraph">
<p>EL predicates are special meta-operators that are used to express tests on runtime object structures.</p>
</div>
<div class="sect3">
<h4 id="_attached_predicate"><a class="anchor" href="#_attached_predicate"></a>4.5.1. Attached() Predicate</h4>
<div class="paragraph">
<p>The <code>attached()</code> predicate is the EL equivalent of the expressions such as <code>someVar == null</code> (C, C++, C#, Java), <code>some_var is None</code> (Python) and similar. In EL, a reference is understood as being <em>attached</em> (or not) to a value. Attached status is therefore tested using <code>attached (ref)</code>, and may be applied to any target of a <a href="https://specifications.openehr.org/releases/LANG/latest/bmm.html#_expressions" target="_blank" rel="noopener">BMM <code>EL_INSTANCE_REF</code></a>, which includes references to variables, properties, constants, functions and tuples.</p>
</div>
<div class="paragraph">
<p><code>Attached()</code> returns a Boolean value, and thus may be negated, to form expressions such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">not</span> <span class="tok-n">attached</span> <span class="tok-p">(</span><span class="tok-n">test_result</span><span class="tok-p">)</span> <span class="tok-n">or</span> <span class="tok-k">else</span> <span class="tok-n">test_result</span><span class="tok-p">.</span><span class="tok-k">data</span><span class="tok-p">.</span><span class="tok-n">events</span><span class="tok-p">[</span><span class="tok-m">1</span><span class="tok-p">].</span><span class="tok-k">data</span><span class="tok-p">.</span><span class="tok-n">value</span> <span class="tok-p">&gt;</span> <span class="tok-m">6.5</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_agents"><a class="anchor" href="#_agents"></a>4.6. Agents</h3>
<div class="paragraph">
<p>Delayed routine calls for both functions and procedures may occur as terminals in an EL expression. The evaluation type (<code><em>eval_type</em></code>) of an agent is its <code><em>signature</em></code>. Syntactically, these take various forms. An agent can be created using a function or procedure visible in the current scope, using the keyword <code>agent</code>. The arguments list may range from empty to full. For a completely empty list, the routine name on its own may be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">define</span> <span class="tok-n">a</span> <span class="tok-n">naive</span> <span class="tok-n">obstetric</span> <span class="tok-n">risk</span> <span class="tok-n">function</span>
    <span class="tok-p">|</span>
    <span class="tok-n">obstetric_risk</span> <span class="tok-p">(</span><span class="tok-n">age</span><span class="tok-p">:</span> <span class="tok-n">Duration</span><span class="tok-p">[</span><span class="tok-m">1</span><span class="tok-p">];</span> <span class="tok-n">previous_pregnancies</span><span class="tok-p">:</span> <span class="tok-n">Integer</span><span class="tok-p">[</span><span class="tok-m">1</span><span class="tok-p">]):</span> <span class="tok-n">Coded_term</span><span class="tok-p">[</span><span class="tok-m">1</span><span class="tok-p">]</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">generate</span> <span class="tok-n">an</span> <span class="tok-n">agent</span> <span class="tok-n">with</span> <span class="tok-n">signature</span> <span class="tok-p">&lt;[</span><span class="tok-n">Duration</span><span class="tok-p">,</span> <span class="tok-n">Integer</span><span class="tok-p">],</span> <span class="tok-n">Coded_term</span><span class="tok-p">&gt;</span>
    <span class="tok-p">|</span>
    <span class="tok-n">agent</span> <span class="tok-n">obstetric_risk</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For a partial argument list, <code>?</code> symbols are used for the non-filled arguments. This generates an agent whose signature corresponds to the remaining open arguments. In the following example, an agent of the signature <code>&lt;[Integer], Coded_term&gt;</code> is generated, which, since the age of 38 years is supplied, may be thought of as a new function called <code>obstetric_risk_38_years()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">agent</span> <span class="tok-n">obstetric_risk</span> <span class="tok-p">(</span><span class="tok-err">&#39;</span><span class="tok-n">P38Y</span><span class="tok-err">&#39;</span><span class="tok-p">,</span> <span class="tok-p">?)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Theoretically, an agent could be created with all arguments supplied, without the intention of immediate execution, e.g. <code>agent obstetric_risk ('P38Y', 2)</code>, which would generate an agent of signature <code>&lt;[],Coded_term&gt;</code>. This could be later executed by simply using the receiver variable or parameter reference in the normal way, in a later expression.</p>
</div>
<div class="paragraph">
<p>Agents for procedure calls can be created in the same way as described above. In each case, the evaluation type is a signature of the form <code>&lt;[args]&gt;</code>, i.e. having no return type.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_complex_expressions"><a class="anchor" href="#_complex_expressions"></a>5. Complex Expressions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Complex expressions in EL consist of non-atomic value-returning expressions, in a typed, operator-based syntax common to many programming languages and logics. In EL, the syntactic use of operators is understood as a shorthand for specific functions assumed to be available on types inferred from the context of the operator use. An EL implementation would therefore map such operators to the appropriate methods in a class library.</p>
</div>
<div class="sect2">
<h3 id="_equality_operator"><a class="anchor" href="#_equality_operator"></a>5.1. Equality Operator</h3>
<div class="paragraph">
<p>The equality operator <code>=</code> in EL is understood as the function <code><em>equal</em>()</code> defined on the type <code>Any</code>, of which every other class is a descendant. For all primitive value types (types for which use in expressions directly generates values rather than instance references), the semantics are value comparison, while for all other types, the semantics are reference comparison. For non-openEHR models, <code>'='</code> will normally map to a similarly-named method, e.g. <code><em>equals</em>()</code>.</p>
</div>
<div class="paragraph">
<p>To obtain value comparison for non-value types, the function <code>Any.<em>is_equal</em>()</code>, which may be redefined in any sub-type, is used.</p>
</div>
</div>
<div class="sect2">
<h3 id="_primitive_operators"><a class="anchor" href="#_primitive_operators"></a>5.2. Primitive Operators</h3>
<div class="paragraph">
<p>Primitive operators in EL are the infix or prefix syntax forms of functions available on primitive types. For example, the operator <code>-</code> (minus) is defined on the class <code>Numeric</code> (an inheritance ancestor of the classes <code>Integer</code>, <code>Real</code> etc) as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-k">in</span> <span class="tok-k">class</span> <span class="tok-nc">Numeric</span>
    <span class="tok-p">|</span>
    <span class="tok-n">subtract</span> <span class="tok-p">(</span><span class="tok-n">other</span><span class="tok-p">:</span> <span class="tok-n">Numeric</span><span class="tok-p">):</span> <span class="tok-n">Numeric</span>
        <span class="tok-n">alias</span> <span class="tok-k">infix</span> <span class="tok-sc">&#39;-&#39;</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">redefined</span> <span class="tok-k">in</span> <span class="tok-k">class</span> <span class="tok-nc">Integer</span> <span class="tok-k">as</span>
    <span class="tok-p">|</span>
    <span class="tok-n">subtract</span> <span class="tok-p">(</span><span class="tok-n">other</span><span class="tok-p">:</span> <span class="tok-n">Integer</span><span class="tok-p">):</span> <span class="tok-n">Integer</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This means that where the expression <code>100 - 5</code> is encountered in EL, what is really invoked is <code>{Integer}.<em>subtract</em>()</code>, specifically <code>100.<em>subtract</em>(5)</code>.</p>
</div>
<div class="paragraph">
<p>For convenience, the operators for the <code>Numeric</code> and <code>Boolean</code> types from the <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html" target="_blank" rel="noopener">openEHR Foundation Types</a> are reproduced below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operators</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Arithmetic Operators - Numeric operands and result; descending precendence order</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exponent()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exponentiation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>multiply()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Multiplication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>divide()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>%</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modulus()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modulo (whole number) division</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Addition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtraction</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Relational Operators - Numeric, Date/time operands and Boolean result; equal precedence</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>equal()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value equality</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!=</code>, <code>≠</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not_equal()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inequality relation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>less_than()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than relation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;=</code>, <code>≤</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>less_than_or_equal()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal relation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>greater_than()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than relation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&gt;=</code>, <code>≥</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>greater_than_or_equal()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal relation</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Logical Operators - Boolean operands and result; descending precendence order</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NOT</code>, <code>~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>not()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Negation, "not p"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AND</code>, <code>∧</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conjunction()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical conjunction, "p and q"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OR</code>, <code>∨</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disjunction()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logical disjunction, "p or q"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XOR</code>, <code>⊻</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>exclusive_disjunction()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exclusive or, "only one of p or q"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMPLIES</code>, <code>⇒</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>implication()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Material implication, "p implies q", or "if p then q"</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Expressions using logical operators may thus be written using standard English names or symbols, as in the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">systolic_bp</span> <span class="tok-p">&gt;</span> <span class="tok-m">140</span> <span class="tok-n">AND</span> <span class="tok-p">(</span><span class="tok-n">is_smoker</span> <span class="tok-n">OR</span> <span class="tok-n">is_hypertensive</span><span class="tok-p">)</span>

    <span class="tok-n">systolic_bp</span> <span class="tok-p">&gt;</span> <span class="tok-m">140</span> <span class="tok-err">∧</span> <span class="tok-p">(</span><span class="tok-n">is_smoker</span> <span class="tok-err">∨</span> <span class="tok-n">is_hypertensive</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, some operators are defined on the other primitive types, including the following.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 57.1428%;">
<col style="width: 28.5715%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><code>String</code> Operators</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>String.append(other: String): String</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String concatenation, appending</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><code>Iso8601_date</code> arithmetic operators</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add(d: Iso8601_duration): Iso8601_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a precise duration to a date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add_nominal(d: Iso8601_duration): Iso8601_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a nominal duration to a date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract(d: Iso8601_duration): Iso8601_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract a precise duration from a date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract_nominal(d: Iso8601_duration): Iso8601_date</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract a nominal duration from a date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diff(d: Date): Iso8601_duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference of two dates</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><code>Iso8601_date_time</code> arithmetic operators</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add(d: Iso8601_duration): Iso8601_date_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a precise duration to a date/time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>++</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add(d: Iso8601_duration): Iso8601_date_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a nominal duration to a date/time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract(d: Iso8601_duration): Iso8601_date_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract a precise duration from a date/time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract_nominal(d: Iso8601_duration): Iso8601_date_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract a nominal duration from a date/time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diff(d: Date_time): Iso8601_duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference of two date/times</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><code>Iso8601_time</code> arithmetic operators</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add(d: Iso8601_duration): Iso8601_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a duration to a time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract(d: Iso8601_duration): Iso8601_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract a duration from a time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>diff(d: Time): Iso8601_duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference of two times</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock"><code>Iso8601_duration</code> arithmetic operators</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>+</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>add(d: Iso8601_duration): Iso8601_duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add a duration to a duration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>subtract(d: Iso8601_duration):Iso8601_duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subtract a duration from a duration</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Operator semantics that require further explanation are described below.</p>
</div>
<div class="sect3">
<h4 id="_logical_negation"><a class="anchor" href="#_logical_negation"></a>5.2.1. Logical Negation</h4>
<div class="paragraph">
<p>All Boolean operators take Boolean operands and generate a Boolean result. The <code>not</code> operator can be applied as a prefix operator to all operators returning a Boolean result as well as a parenthesised Boolean expression.</p>
</div>
</div>
<div class="sect3">
<h4 id="_precedence_and_parentheses"><a class="anchor" href="#_precedence_and_parentheses"></a>5.2.2. Precedence and Parentheses</h4>
<div class="paragraph">
<p>The precedence of operators follows the order shown in the operator tables above. To change precedence, parentheses can be used in the fashion typical of most programming languages, as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">systolic_bp</span> <span class="tok-p">&gt;</span> <span class="tok-m">140</span> <span class="tok-n">AND</span> <span class="tok-p">(</span><span class="tok-n">is_smoker</span> <span class="tok-n">OR</span> <span class="tok-n">is_hypertensive</span><span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_higher_order_operators"><a class="anchor" href="#_higher_order_operators"></a>5.3. Higher-order Operators</h3>
<div class="sect3">
<h4 id="_quantification_operators"><a class="anchor" href="#_quantification_operators"></a>5.3.1. Quantification Operators</h4>
<div class="paragraph">
<p>The two standard quantification operators from predicate logic <code>there exists</code> (∃ operator) and <code>for all</code> (∀ operator) are defined in EL for the container types found in the <a href="https://specifications.openehr.org/releases/BASE/latest/foundation_types.html" target="_blank" rel="noopener">openEHR Foundation Types</a>.</p>
</div>
<div class="paragraph">
<p>The textual syntax of <code>there exists</code> is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    there_exists v in container_var | &lt;Boolean expression mentioning v&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>|</code> symbol is usually read in English as 'such that'. The symbolic equivalent may also be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    ∃ v : container_var | &lt;Boolean expression mentioning v&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The above may also be expressed in EL as its functional equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">list_of_reals</span><span class="tok-p">:</span> <span class="tok-n">List</span><span class="tok-p">&lt;</span><span class="tok-n">Real</span><span class="tok-p">&gt;</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">an</span> <span class="tok-n">expression</span> <span class="tok-n">that</span> <span class="tok-n">will</span> <span class="tok-k">return</span> <span class="tok-k">true</span> <span class="tok-k">if</span> <span class="tok-n">list_of_reals</span>
    <span class="tok-p">|</span> <span class="tok-n">contains</span> <span class="tok-n">a</span> <span class="tok-n">value</span> <span class="tok-n">greater</span> <span class="tok-n">than</span> <span class="tok-m">140.0</span>
    <span class="tok-p">|</span>
    <span class="tok-n">list_of_reals</span><span class="tok-p">.</span><span class="tok-n">there_exists</span> <span class="tok-p">(</span>
        <span class="tok-n">agent</span> <span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">:</span> <span class="tok-n">Real</span><span class="tok-p">):</span> <span class="tok-n">Boolean</span> <span class="tok-p">{</span>
            <span class="tok-n">v</span> <span class="tok-p">&gt;</span> <span class="tok-m">140.0</span>
        <span class="tok-p">}</span>
    <span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>for_all</code> operator has similar textual syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    for_all v in container_var | &lt;Boolean expression mentioning v&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Here, the <code>|</code> symbol is normally read in English as as 'it holds that'. The symbolic equivalent may also be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    ∀ v : container_var | &lt;Boolean expression mentioning v&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The above may also be expressed in EL as its functional equivalent:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">list_of_reals</span><span class="tok-p">:</span> <span class="tok-n">List</span><span class="tok-p">&lt;</span><span class="tok-n">Real</span><span class="tok-p">&gt;</span>

    <span class="tok-p">|</span>
    <span class="tok-p">|</span> <span class="tok-n">an</span> <span class="tok-n">expression</span> <span class="tok-n">that</span> <span class="tok-n">will</span> <span class="tok-k">return</span> <span class="tok-k">true</span> <span class="tok-k">if</span> <span class="tok-n">list_of_reals</span>
    <span class="tok-p">|</span> <span class="tok-n">consists</span> <span class="tok-n">of</span> <span class="tok-n">values</span> <span class="tok-n">all</span> <span class="tok-n">greater</span> <span class="tok-n">than</span> <span class="tok-m">140.0</span>
    <span class="tok-p">|</span>
    <span class="tok-n">list_of_reals</span><span class="tok-p">.</span><span class="tok-n">for_all</span> <span class="tok-p">(</span>
        <span class="tok-n">agent</span> <span class="tok-p">(</span><span class="tok-n">v</span><span class="tok-p">:</span> <span class="tok-n">Real</span><span class="tok-p">):</span> <span class="tok-n">Boolean</span> <span class="tok-p">{</span>
            <span class="tok-n">v</span> <span class="tok-p">&gt;</span> <span class="tok-m">140.0</span>
        <span class="tok-p">}</span>
    <span class="tok-p">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_decision_tables"><a class="anchor" href="#_decision_tables"></a>5.4. Decision Tables</h3>
<div class="paragraph">
<p>In EL, a <em>decision table</em> is a construct that expresses the equivalent logic of a multi-branch construct that returns a single expression as a result. There are two flavours, both familiar to programmers in mainstream languages: the <em>condition chain</em> (i.e. an if/then/else construct) and the <em>case table</em> (i.e. a case statement). The evaluation of both constructs determines which of a number of possible expressions to return as the result, based on the prior evaluation of branch conditions, whose particular form depends on which flavour of construct is used. Both constructs are thus purely functional, i.e. their branches cannot contain statements (i.e. assignments, procedure calls etc), only expressions.</p>
</div>
<div class="sect3">
<h4 id="_condition_chain_ifthen"><a class="anchor" href="#_condition_chain_ifthen"></a>5.4.1. Condition Chain (if/then)</h4>
<div class="paragraph">
<p>The syntax for a condition chain (the if/then equivalent) takes a standard form and a compact form. The standard form is as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">choice</span> <span class="tok-k">in</span>
        <span class="tok-p">&lt;</span><span class="tok-n">condition_1</span><span class="tok-p">&gt;:</span>  <span class="tok-p">&lt;</span><span class="tok-n">expression_1</span><span class="tok-p">&gt;,</span>
        <span class="tok-p">&lt;</span><span class="tok-n">condition_2</span><span class="tok-p">&gt;:</span>  <span class="tok-p">&lt;</span><span class="tok-n">expression_2</span><span class="tok-p">&gt;,</span>
        <span class="tok-p">...</span>
        <span class="tok-p">&lt;</span><span class="tok-n">condition_N</span><span class="tok-p">&gt;:</span>  <span class="tok-p">&lt;</span><span class="tok-n">expression_N</span><span class="tok-p">&gt;,</span>
        <span class="tok-p">*:</span>              <span class="tok-p">&lt;</span><span class="tok-k">else</span> <span class="tok-n">expression</span><span class="tok-p">&gt;</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above, the <code>'*'</code> character is understood as a wildcard, meaning 'all other cases'. A final row containing <code>'*'</code> is thus equivalent to a catch-all 'else' branch in the if/then/else chain of a procedural language.</p>
</div>
<div class="paragraph">
<p>A realistic example is illustrated below, making use of line comments to visually aid the author.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">molecular_subtype</span><span class="tok-p">:</span> <span class="tok-n">Terminology_term</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span> <span class="tok-n">choice</span> <span class="tok-k">in</span>
            <span class="tok-p">=========================================================</span>
            <span class="tok-n">er_positive</span> <span class="tok-n">and</span>
            <span class="tok-n">her2_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">not</span> <span class="tok-n">ki67</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">high</span><span class="tok-p">]):</span>    <span class="tok-err">#</span><span class="tok-n">luminal_A</span><span class="tok-p">,</span>
            <span class="tok-p">---------------------------------------------------------</span>
            <span class="tok-n">er_positive</span> <span class="tok-n">and</span>
            <span class="tok-n">her2_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">ki67</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">high</span><span class="tok-p">]):</span>        <span class="tok-err">#</span><span class="tok-n">luminal_B_HER2_negative</span><span class="tok-p">,</span>
            <span class="tok-p">---------------------------------------------------------</span>
            <span class="tok-n">er_positive</span> <span class="tok-n">and</span>
            <span class="tok-n">her2_positive</span><span class="tok-p">:</span>                 <span class="tok-err">#</span><span class="tok-n">luminal_B_HER2_positive</span><span class="tok-p">,</span>
            <span class="tok-p">---------------------------------------------------------</span>
            <span class="tok-n">er_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">pr_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">her2_positive</span> <span class="tok-n">and</span>
            <span class="tok-n">ki67</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">high</span><span class="tok-p">]):</span>        <span class="tok-err">#</span><span class="tok-n">HER2</span><span class="tok-p">,</span>
            <span class="tok-p">---------------------------------------------------------</span>
            <span class="tok-n">er_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">pr_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">her2_negative</span> <span class="tok-n">and</span>
            <span class="tok-n">ki67</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">([</span><span class="tok-n">high</span><span class="tok-p">]):</span>        <span class="tok-err">#</span><span class="tok-n">triple_negative</span><span class="tok-p">,</span>
            <span class="tok-p">---------------------------------------------------------</span>
            <span class="tok-p">*:</span>                             <span class="tok-err">#</span><span class="tok-n">none</span>
            <span class="tok-p">=========================================================</span>
        <span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the common degenerate case where there is a single condition, the standard form looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">calculate_score</span><span class="tok-p">:</span> <span class="tok-n">Integer</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span> <span class="tok-n">choice</span> <span class="tok-k">in</span>
            <span class="tok-p">============</span>
            <span class="tok-n">expr1</span><span class="tok-p">:</span>    <span class="tok-m">2</span><span class="tok-p">,</span>
            <span class="tok-p">------------</span>
            <span class="tok-p">*:</span>        <span class="tok-m">0</span>
            <span class="tok-p">============</span>
        <span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>While perfectly understandable (and legal syntax), the following compact form may be used instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">calculate_score</span><span class="tok-p">:</span> <span class="tok-n">Integer</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span> <span class="tok-n">expr1</span> <span class="tok-p">?</span> <span class="tok-m">2</span> <span class="tok-p">:</span> <span class="tok-m">0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above syntax is adopted from the C language family. It may be used to construct intelligible conditional arithmetic operations such as summing, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">ipi_raw_score</span><span class="tok-p">:</span> <span class="tok-n">Integer</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span> <span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-n">add</span> <span class="tok-p">(</span>
            <span class="tok-p">=============================================</span>
            <span class="tok-n">age</span> <span class="tok-p">&gt;</span> <span class="tok-m">60</span>                             <span class="tok-p">?</span> <span class="tok-m">1</span> <span class="tok-p">:</span> <span class="tok-m">0</span><span class="tok-p">,</span>
            <span class="tok-n">staging</span> <span class="tok-err">∈</span> <span class="tok-p">{</span><span class="tok-err">#</span><span class="tok-n">stage_III</span><span class="tok-p">,</span> <span class="tok-err">#</span><span class="tok-n">stage_IV</span><span class="tok-p">}</span>    <span class="tok-p">?</span> <span class="tok-m">1</span> <span class="tok-p">:</span> <span class="tok-m">0</span><span class="tok-p">,</span>
            <span class="tok-n">ldh</span><span class="tok-p">.</span><span class="tok-n">in_range</span> <span class="tok-p">(</span><span class="tok-err">#</span><span class="tok-n">normal</span><span class="tok-p">)</span>               <span class="tok-p">?</span> <span class="tok-m">1</span> <span class="tok-p">:</span> <span class="tok-m">0</span><span class="tok-p">,</span>
            <span class="tok-n">ecog</span> <span class="tok-p">&gt;</span> <span class="tok-m">1</span>                             <span class="tok-p">?</span> <span class="tok-m">1</span> <span class="tok-p">:</span> <span class="tok-m">0</span><span class="tok-p">,</span>
            <span class="tok-n">extranodal_sites</span> <span class="tok-p">&gt;</span> <span class="tok-m">1</span>                 <span class="tok-p">?</span> <span class="tok-m">1</span> <span class="tok-p">:</span> <span class="tok-m">0</span>
            <span class="tok-p">=============================================</span>
        <span class="tok-p">)</span>
        <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_case_table"><a class="anchor" href="#_case_table"></a>5.4.2. Case Table</h4>
<div class="paragraph">
<p>The Case Table syntax form (case statement equivalent) is logically no different from the more general condition chain, except that every branch condition expression takes the form <code>Expr ∈ Constr<sub>i</sub></code>, where <code>Expr</code> is the same expression left-hand side for all branches, each having a variable right-hand side in the form of a value range constraint. Here the <code>∈</code> operator is read as 'is in', i.e. set-membership. The case table construct is designed to enable the value of a single determining expression to be tested against any number of value ranges. This is illustrated in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">gfr_range</span><span class="tok-p">:</span> <span class="tok-n">Real</span>

    <span class="tok-n">risk_assessment</span><span class="tok-p">:</span> <span class="tok-n">Real</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span> <span class="tok-n">case</span> <span class="tok-n">gfr_range</span> <span class="tok-k">in</span>
            <span class="tok-p">=================</span>
            <span class="tok-p">|&gt;</span><span class="tok-m">20</span><span class="tok-p">|:</span>      <span class="tok-m">1</span><span class="tok-p">,</span>
            <span class="tok-p">|</span><span class="tok-m">10</span> <span class="tok-p">-</span> <span class="tok-m">20</span><span class="tok-p">|:</span>  <span class="tok-m">0.75</span><span class="tok-p">,</span>
            <span class="tok-p">|&lt;</span><span class="tok-m">10</span><span class="tok-p">|:</span>      <span class="tok-m">0.5</span>
            <span class="tok-p">=================</span>
        <span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This expression returns one of the values 1, 0.75 or 0.5, depending on the evaluated value of <code>gfr_range</code>, but it could equally return the value of a more complex expression, including further instances of Case tables, Condition chains, operator expressions etc.</p>
</div>
</div>
<div class="sect3">
<h4 id="_nested_case_table"><a class="anchor" href="#_nested_case_table"></a>5.4.3. Nested Case Table</h4>
<div class="paragraph">
<p>The following shows the use of nested case tables to achieve the effect of a credit application test, from an example in the <a href="https://www.omg.org/spec/DMN/" target="_blank" rel="noopener">DMN</a> specification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span>    <span class="tok-n">post_bureau_risk_category</span><span class="tok-p">:</span> <span class="tok-n">Terminology_term</span>
        <span class="tok-n">Result</span> <span class="tok-p">:=</span> <span class="tok-n">case</span> <span class="tok-n">existing_customer</span> <span class="tok-k">in</span>
            <span class="tok-p">========================================</span>
            <span class="tok-n">True</span><span class="tok-p">:</span>   <span class="tok-n">case</span>
                    <span class="tok-n">appl_risk_score</span>
                    <span class="tok-k">in</span>
                    <span class="tok-p">--------------------------------</span>
                    <span class="tok-p">|</span><span class="tok-err">≤</span><span class="tok-m">120</span><span class="tok-p">|:</span>     <span class="tok-n">case</span>
                                <span class="tok-n">credit_score</span>
                                <span class="tok-k">in</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">|&lt;</span><span class="tok-m">590</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                <span class="tok-p">|</span><span class="tok-m">590.</span><span class="tok-p">.</span><span class="tok-m">610</span><span class="tok-p">|:</span>  <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                <span class="tok-p">|&gt;</span><span class="tok-m">610</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">LOW</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">;,</span>
                    <span class="tok-p">|&gt;</span><span class="tok-m">120</span><span class="tok-p">|:</span>     <span class="tok-n">case</span>
                                <span class="tok-n">credit_score</span>
                                <span class="tok-k">in</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">|&lt;</span><span class="tok-m">600</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                <span class="tok-p">|</span><span class="tok-m">600.</span><span class="tok-p">.</span><span class="tok-m">625</span><span class="tok-p">|:</span>  <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                <span class="tok-p">|&gt;</span><span class="tok-m">625</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">LOW</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">;</span>
                    <span class="tok-p">--------------------------------</span>
                    <span class="tok-p">;,</span>
            <span class="tok-n">False</span><span class="tok-p">:</span>  <span class="tok-n">case</span>
                    <span class="tok-n">appl_risk_score</span>
                    <span class="tok-k">in</span>
                    <span class="tok-p">--------------------------------</span>
                    <span class="tok-p">|</span><span class="tok-err">≤</span><span class="tok-m">100</span><span class="tok-p">|:</span>     <span class="tok-n">case</span>
                                <span class="tok-n">credit_score</span>
                                <span class="tok-k">in</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">|&lt;</span><span class="tok-m">580</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                <span class="tok-p">|</span><span class="tok-m">580.</span><span class="tok-p">.</span><span class="tok-m">600</span><span class="tok-p">|:</span>  <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                <span class="tok-p">|&gt;</span><span class="tok-m">600</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">LOW</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">;,</span>
                    <span class="tok-p">|&gt;</span><span class="tok-m">100</span><span class="tok-p">|:</span>     <span class="tok-n">case</span>
                                <span class="tok-n">credit_score</span>
                                <span class="tok-k">in</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">|&lt;</span><span class="tok-m">590</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                <span class="tok-p">|</span><span class="tok-m">590.</span><span class="tok-p">.</span><span class="tok-m">615</span><span class="tok-p">|:</span>  <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                <span class="tok-p">|&gt;</span><span class="tok-m">615</span><span class="tok-p">|:</span>      <span class="tok-err">#</span><span class="tok-n">LOW</span>
                                <span class="tok-p">--------------------</span>
                                <span class="tok-p">;</span>
                    <span class="tok-p">--------------------------------</span>
                    <span class="tok-p">;</span>
            <span class="tok-p">========================================</span>
            <span class="tok-p">;</span>
        <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_multi_dimensional_case_table_experimental"><a class="anchor" href="#_multi_dimensional_case_table_experimental"></a>5.4.4. Multi-dimensional Case Table (experimental)</h4>
<div class="paragraph">
<p>The credit assessment example above can be recoded as a sparse table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">post_bureau_risk_category</span> <span class="tok-p">:=</span> <span class="tok-n">multicase</span>
    <span class="tok-p">=======================================================================================</span>
   <span class="tok-p">{</span><span class="tok-n">existing_customer</span><span class="tok-p">,</span>  <span class="tok-n">appl_risk_score</span><span class="tok-p">,</span>        <span class="tok-n">credit_score</span><span class="tok-p">}</span> <span class="tok-k">in</span>
    <span class="tok-p">---------------------------------------------------------------------------------------</span>
    <span class="tok-n">True</span><span class="tok-p">:</span>               <span class="tok-p">|</span><span class="tok-err">≤</span><span class="tok-m">120</span><span class="tok-p">|:</span>                 <span class="tok-p">|&lt;</span><span class="tok-m">590</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                                <span class="tok-p">|</span><span class="tok-m">590.</span><span class="tok-p">.</span><span class="tok-m">610</span><span class="tok-p">|:</span>     <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                                <span class="tok-p">|&gt;</span><span class="tok-m">610</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">LOW</span><span class="tok-p">;</span>
                        <span class="tok-p">-------------------------------------------------------------------</span>
                        <span class="tok-p">|&gt;</span><span class="tok-m">120</span><span class="tok-p">|:</span>                 <span class="tok-p">|&lt;</span><span class="tok-m">600</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                                <span class="tok-p">|</span><span class="tok-m">600.</span><span class="tok-p">.</span><span class="tok-m">625</span><span class="tok-p">|:</span>     <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                                <span class="tok-p">|&gt;</span><span class="tok-m">625</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">LOW</span><span class="tok-p">;</span>
                        <span class="tok-p">,</span>
   <span class="tok-p">----------------------------------------------------------------------------------------</span>
   <span class="tok-n">False</span><span class="tok-p">:</span>               <span class="tok-p">|</span><span class="tok-err">≤</span><span class="tok-m">100</span><span class="tok-p">|:</span>                 <span class="tok-p">|&lt;</span><span class="tok-m">580</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                                <span class="tok-p">|</span><span class="tok-m">580.</span><span class="tok-p">.</span><span class="tok-m">600</span><span class="tok-p">|:</span>     <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                                <span class="tok-p">|&gt;</span><span class="tok-m">600</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">LOW</span><span class="tok-p">;</span>
                        <span class="tok-p">-------------------------------------------------------------------</span>
                        <span class="tok-p">|&gt;</span><span class="tok-m">100</span><span class="tok-p">|:</span>                 <span class="tok-p">|&lt;</span><span class="tok-m">590</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">HIGH</span><span class="tok-p">,</span>
                                                <span class="tok-p">|</span><span class="tok-m">590.</span><span class="tok-p">.</span><span class="tok-m">615</span><span class="tok-p">|:</span>     <span class="tok-err">#</span><span class="tok-n">MEDIUM</span><span class="tok-p">,</span>
                                                <span class="tok-p">|&gt;</span><span class="tok-m">615</span><span class="tok-p">|:</span>         <span class="tok-err">#</span><span class="tok-n">LOW</span><span class="tok-p">;</span>
                        <span class="tok-p">;</span>
    <span class="tok-p">=======================================================================================</span>
    <span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_two_dimensional_tables_experimental"><a class="anchor" href="#_two_dimensional_tables_experimental"></a>5.4.5. Two-dimensional Tables (experimental)</h4>
<div class="paragraph">
<p>Two-dimensional decision tables are common in all sectors. Although they can be reduced to a condition chain, EL provides a more direct syntax that enables them to be expressed in a form visually very close to their logical form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="kotlin"><span></span><span class="tok-n">item</span> <span class="tok-k">in</span>
    <span class="tok-p">==========================================================================</span>
                   <span class="tok-p">{</span>    <span class="tok-n">isEconomy</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">),</span>   <span class="tok-n">isBusiness</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">),</span>      <span class="tok-n">isFirstClass</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">)</span> <span class="tok-p">},</span>
    <span class="tok-p">--------------------------------------------------------------------------</span>
    <span class="tok-n">isChild</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">):</span>    <span class="tok-p">{</span>    <span class="tok-m">50</span><span class="tok-p">,</span>             <span class="tok-m">250</span><span class="tok-p">,</span>                <span class="tok-m">1000</span>            <span class="tok-p">},</span>
    <span class="tok-p">--------------------------------------------------------------------------</span>
    <span class="tok-n">isAdult</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">):</span>    <span class="tok-p">{</span>    <span class="tok-m">250</span> <span class="tok-p">+</span> <span class="tok-n">trip</span><span class="tok-p">.</span><span class="tok-n">d</span><span class="tok-p">,</span>   <span class="tok-m">450</span> <span class="tok-p">+</span> <span class="tok-n">trip</span><span class="tok-p">.</span><span class="tok-n">d</span><span class="tok-p">,</span>       <span class="tok-m">750</span> <span class="tok-p">+</span> <span class="tok-n">trip</span><span class="tok-p">.</span><span class="tok-n">d</span>    <span class="tok-p">},</span>
    <span class="tok-p">--------------------------------------------------------------------------</span>
    <span class="tok-n">isMilitary</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">):</span> <span class="tok-p">{</span>    <span class="tok-m">90</span><span class="tok-p">,</span>             <span class="tok-m">250</span><span class="tok-p">,</span>                <span class="tok-m">750</span> <span class="tok-p">-</span> <span class="tok-m">2</span> <span class="tok-p">*</span> <span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-n">age</span> <span class="tok-p">}</span>
    <span class="tok-p">==========================================================================</span>
<span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_syntax_specification"><a class="anchor" href="#_syntax_specification"></a>Appendix A: Syntax Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Antlr4 files may be found for EL at in the <a href="https://github.com/openEHR/openEHR-antlr4/tree/master/combined/src/main/antlr" target="_blank" rel="noopener">openEHR Antlr4 Git repository</a>.</p>
</div>
<div class="paragraph">
<p>The Antlr4 grammar for the EL syntax is shown below.
 </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="antlr-java"><span></span><span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">//  description: Antlr4 grammar for openEHR Expression Language baed on BMM meta-model.</span><span class="tok-w"></span>
<span class="tok-c">//  author:      Thomas Beale &lt;thomas.beale@openehr.org&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  contributors:Pieter Bos &lt;pieter.bos@nedap.com&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  support:     openEHR Specifications PR tracker &lt;https://openehr.atlassian.net/projects/SPECPR/issues&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  copyright:   Copyright (c) 2016- openEHR Foundation &lt;http://www.openEHR.org&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  license:     Apache 2.0 License &lt;http://www.apache.org/licenses/LICENSE-2.0.html&gt;</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-k">parser</span><span class="tok-w"> </span><span class="tok-k">grammar</span><span class="tok-w"> </span><span class="tok-nc">ElParser</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-k">options</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nv">tokenVocab</span><span class="tok-p">=</span>ElLexer<span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-nl">import</span><span class="tok-w"> </span><span class="tok-err">Cadl2Parser;</span><span class="tok-w"></span>



<span class="tok-c">// ========================== EL Statements ==========================</span><span class="tok-w"></span>

<span class="tok-err">statementBlock</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">statement</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-no">EOF</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">statement</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">declaration</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">assignment</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">assertion</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">declaration</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">variableDeclaration</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">constantDeclaration</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">variableDeclaration</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">instantiableRef</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">typeId</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">SYM_ASSIGNMENT</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">constantDeclaration</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">constantId</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">typeId</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">SYM_EQ</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">assignment</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"> </span><span class="tok-no">SYM_ASSIGNMENT</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">assertion</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">LC_ID</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">UC_ID</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-no">SYM_ASSERT</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// ========================== EL Expressions ==========================</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Expressions are either value-generators, or operator expressions (containing value-generators)</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">expression</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">terminal</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">operatorExpression</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">tuple</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">operatorExpression</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// ------------------- Boolean-returning operator expressions --------------------</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Expressions evaluating to boolean values, using standard precedence;</span><span class="tok-w"></span>
<span class="tok-c">// These map to ordinary 1- and 2-argument function calls on Boolean instances</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">booleanExpr</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-no">SYM_NOT</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-no">SYM_AND</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-no">SYM_XOR</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-no">SYM_OR</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-no">SYM_IMPLIES</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">SYM_IFF</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_EQ</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">booleanLeaf</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Atomic Boolean-valued expression elements</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">booleanLeaf</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">booleanValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">forAllExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">thereExistsExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">arithmeticConstraintExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">generalConstraintExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_DEFINED</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">arithmeticComparisonExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">objectComparisonExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">//  Universal and existential quantifier</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">forAllExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">SYM_FOR_ALL</span><span class="tok-w"> </span><span class="tok-nv">localVariableId</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"> </span><span class="tok-s">&#39;|&#39;</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">thereExistsExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">SYM_THERE_EXISTS</span><span class="tok-w"> </span><span class="tok-nv">localVariableId</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"> </span><span class="tok-s">&#39;|&#39;</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// Constraint expressions</span><span class="tok-w"></span>
<span class="tok-c">// This provides a way of using one operator (matches) to compare a</span><span class="tok-w"></span>
<span class="tok-c">// value (LHS) with a value range (RHS). As per ADL, the value range</span><span class="tok-w"></span>
<span class="tok-c">// for ordered types like Integer, Date etc may be a single value,</span><span class="tok-w"></span>
<span class="tok-c">// a list of values, or a list of intervals, and in future, potentially</span><span class="tok-w"></span>
<span class="tok-c">// other comparators, including functions (e.g. divisible_by_N).</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// For non-ordered types like String and Terminology_code, the RHS</span><span class="tok-w"></span>
<span class="tok-c">// is in other forms, e.g. regex for Strings.</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// The matches operator can be used to generate a Boolean value that</span><span class="tok-w"></span>
<span class="tok-c">// may be used within an expression like any other Boolean (hence it</span><span class="tok-w"></span>
<span class="tok-c">// is a booleanLeaf).</span><span class="tok-w"></span>
<span class="tok-c">// TODO: non-primitive objects might be supported on the RHS in future.</span><span class="tok-w"></span>
<span class="tok-nl">arithmeticConstraintExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">arithmeticLeaf</span><span class="tok-w"> </span><span class="tok-no">SYM_MATCHES</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-w"> </span><span class="tok-nv">cInlineOrderedObject</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">generalConstraintExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-no">SYM_MATCHES</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-w"> </span><span class="tok-nv">cObjectMatcher</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// --------------------------- Arithmetic operator expressions --------------------------</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Comparison expressions of arithmetic operands generating Boolean results</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">arithmeticComparisonExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"> </span><span class="tok-nv">comparisonBinop</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">comparisonBinop</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-no">SYM_EQ</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_NE</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_GT</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_LT</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_LE</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_GE</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Expressions evaluating to values of arithmetic types, using standard precedence</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">arithmeticExpr</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-err">&lt;</span><span class="tok-nv">assoc</span><span class="tok-o">=</span><span class="tok-nv">right</span><span class="tok-err">&gt;</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;^&#39;</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39;/&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;*&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;%&#39;</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39;+&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">arithmeticLeaf</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// TODO: need to be able to plug in terminal to allow decision tables in expressions</span><span class="tok-w"></span>
<span class="tok-nl">arithmeticLeaf</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">arithmeticValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-w"> </span><span class="tok-nv">arithmeticExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">simpleCaseTable</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">arithmeticValue</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">integerValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">realValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">dateValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">dateTimeValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">timeValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">durationValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// -------------------- Equality operator expressions for other types ------------------------</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Compare any kind of objects</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">objectComparisonExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-nv">equalityBinop</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">equalityBinop</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-no">SYM_EQ</span><span class="tok-w"></span>
<span class="tok-w">  </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">SYM_NE</span><span class="tok-w"></span>
<span class="tok-w">  </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// -------------------------- tuples -----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-nl">tuple</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;[&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-s">&#39;]&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// -------------------------- value-generating expressions -----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-nl">terminal</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">decisionTable</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">simpleTerminal</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">primitiveValue</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">valueGenerator</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// TODO: Can&#39;t syntactically distinguish between a local or other variable id</span><span class="tok-w"></span>
<span class="tok-c">// and a property or constant reference.</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">valueGenerator</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">bareRef</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">scopedFeatureRef</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">typeRef</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">bareRef</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">boundVariableId</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">staticRef</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">localRef</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">functionCall</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Static and constant feature refs, distinguished by the use of</span><span class="tok-w"></span>
<span class="tok-c">// initial capital in the id.</span><span class="tok-w"></span>
<span class="tok-c">// Will map to EL_READABLE_VARIABLE or EL_STATIC_REF (unscoped)</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">staticRef</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-no">SYM_SELF</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">constantId</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Local writable reference, distinguished by use of initial lowercase id</span><span class="tok-w"></span>
<span class="tok-c">// Will map to EL_WRITABLE_VARIABLE or EL_PROPERTY_REF (unscoped)</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">localRef</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-no">SYM_RESULT</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">localVariableId</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// scoped feature references.</span><span class="tok-w"></span>
<span class="tok-c">// Will map to any EL_FEATURE_REF (scoped)</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">scopedFeatureRef</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">scoper</span><span class="tok-w"> </span><span class="tok-nv">featureRef</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">scoper</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">typeRef</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">bareRef</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">typeRef</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-w"> </span><span class="tok-nv">typeId</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">typeId</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">UC_ID</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;&#39;</span><span class="tok-w"> </span><span class="tok-nv">typeId</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-nv">typeId</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;&#39;</span><span class="tok-w"> </span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">featureRef</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">functionCall</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">instantiableRef</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Instantiable feature refs</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">instantiableRef</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">boundVariableId</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">localVariableId</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">constantId</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// TODO: analyse how a boundVariableId can be created as a built-in feature</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">boundVariableId</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">BOUND_VARIABLE_ID</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">localVariableId</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">LC_ID</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">constantId</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">UC_ID</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Function calls</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">functionCall</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">LC_ID</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-w"> </span><span class="tok-nv">exprList</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;;&#39;</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">exprList</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// -------------------------- decision tables -----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-nl">decisionTable</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">      </span><span class="tok-nv">binaryChoice</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">caseTable</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">conditionTable</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">caseTable</span><span class="tok-p">:</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">simpleCaseTable</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">generalCaseTable</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// condition chains (if/then statement equivalent)</span><span class="tok-w"></span>
<span class="tok-c">// choice in</span><span class="tok-w"></span>
<span class="tok-c">//   =========================================================</span><span class="tok-w"></span>
<span class="tok-c">//   er_positive and</span><span class="tok-w"></span>
<span class="tok-c">//   her2_negative and</span><span class="tok-w"></span>
<span class="tok-c">//   not ki67.in_range (#high):    #luminal_A,</span><span class="tok-w"></span>
<span class="tok-c">//   ---------------------------------------------------------</span><span class="tok-w"></span>
<span class="tok-c">//   er_positive and</span><span class="tok-w"></span>
<span class="tok-c">//   her2_negative and</span><span class="tok-w"></span>
<span class="tok-c">//   ki67.in_range (#high):        #luminal_B_HER2_negative,</span><span class="tok-w"></span>
<span class="tok-c">//   ---------------------------------------------------------</span><span class="tok-w"></span>
<span class="tok-c">//   *:                            #none</span><span class="tok-w"></span>
<span class="tok-c">//   =========================================================</span><span class="tok-w"></span>
<span class="tok-c">//   ;</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">conditionTable</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">SYM_CHOICE</span><span class="tok-w"> </span><span class="tok-no">SYM_IN</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">conditionBranch</span><span class="tok-w"> </span><span class="tok-s">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">conditionBranch</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">conditionDefaultBranch</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-s">&#39;;&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">conditionBranch</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">conditionDefaultBranch</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;*&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Binary-choice version of condition table, using old-school</span><span class="tok-w"></span>
<span class="tok-c">// C/Java syntax:</span><span class="tok-w"></span>
<span class="tok-c">// booleanExpr ? x : y ;</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">binaryChoice</span><span class="tok-p">:</span><span class="tok-w">  </span><span class="tok-nv">booleanExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;?&#39;</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Case tables, e.g.:</span><span class="tok-w"></span>
<span class="tok-c">//     Result := case qCSI_score in</span><span class="tok-w"></span>
<span class="tok-c">//        ============================</span><span class="tok-w"></span>
<span class="tok-c">//        0:          expr0,</span><span class="tok-w"></span>
<span class="tok-c">//        ----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//        |1..2|:     expr1,</span><span class="tok-w"></span>
<span class="tok-c">//        ----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//        |3..5|:     expr2,</span><span class="tok-w"></span>
<span class="tok-c">//        ----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//        |6..8|:     expr3,</span><span class="tok-w"></span>
<span class="tok-c">//        ----------------------------</span><span class="tok-w"></span>
<span class="tok-c">//        |≥ 9|:      expr4</span><span class="tok-w"></span>
<span class="tok-c">//        ============================</span><span class="tok-w"></span>
<span class="tok-c">//     ;</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">generalCaseTable</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">SYM_CASE</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-no">SYM_IN</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">generalCaseBranch</span><span class="tok-w"> </span><span class="tok-s">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">generalCaseBranch</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">generalCaseDefaultBranch</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-s">&#39;;&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">generalCaseBranch</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">primitiveObject</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">generalCaseDefaultBranch</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;*&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">expression</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// Simple value-based (typed) Case tables, e.g.:</span><span class="tok-w"></span>
<span class="tok-c">// case gfr_range in</span><span class="tok-w"></span>
<span class="tok-c">//   =================</span><span class="tok-w"></span>
<span class="tok-c">//   |&gt;20|:      1,</span><span class="tok-w"></span>
<span class="tok-c">//   |10..20|:   0.75,</span><span class="tok-w"></span>
<span class="tok-c">//   |&lt;10|:      0.5</span><span class="tok-w"></span>
<span class="tok-c">//   =================</span><span class="tok-w"></span>
<span class="tok-c">//   ;</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-nl">simpleCaseTable</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">SYM_CASE</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-no">SYM_IN</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">simpleCaseBranch</span><span class="tok-w"> </span><span class="tok-s">&#39;,&#39;</span><span class="tok-w"> </span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-nv">simpleCaseBranch</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">simpleCaseDefaultBranch</span><span class="tok-w"> </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-s">&#39;;&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">simpleCaseBranch</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">primitiveObject</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">simpleCaseDefaultBranch</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;*&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-nv">simpleTerminal</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Antlr4 lexer for the EL syntax is shown below.
 </p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="antlr-java"><span></span><span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">//  description: Antlr4 grammar for openEHR Expression Language baed on BMM meta-model.</span><span class="tok-w"></span>
<span class="tok-c">//  author:      Thomas Beale &lt;thomas.beale@openehr.org&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  contributors:Pieter Bos &lt;pieter.bos@nedap.com&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  support:     openEHR Specifications PR tracker &lt;https://openehr.atlassian.net/projects/SPECPR/issues&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  copyright:   Copyright (c) 2016- openEHR Foundation &lt;http://www.openEHR.org&gt;</span><span class="tok-w"></span>
<span class="tok-c">//  license:     Apache 2.0 License &lt;http://www.apache.org/licenses/LICENSE-2.0.html&gt;</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-k">lexer</span><span class="tok-w"> </span><span class="tok-k">grammar</span><span class="tok-w"> </span><span class="tok-nc">ElLexer</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">import</span><span class="tok-w"> </span><span class="tok-err">AdlPathLexer</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nl">Cadl2PrimitiveValuesLexer</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-nl">GeneralLexer</span><span class="tok-err">;</span><span class="tok-w"></span>

<span class="tok-err">channels</span><span class="tok-w"> </span><span class="tok-p">{</span>
    <span class="tok-n">COMMENT</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-c">// ------------------ lines and comments ------------------</span><span class="tok-w"></span>
<span class="tok-err">CMT_LINE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;--&#39;</span><span class="tok-w"> </span><span class="tok-o">.*?</span><span class="tok-w"> </span><span class="tok-no">EOL</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-nv">channel</span><span class="tok-o">(</span><span class="tok-no">COMMENT</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">TABLE_CMT_LINE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;===&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;=&#39;</span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-no">EOL</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-nv">channel</span><span class="tok-o">(</span><span class="tok-no">COMMENT</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">EOL</span><span class="tok-w">      </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;\r&#39;</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-s">&#39;\n&#39;</span><span class="tok-w">   </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-nv">channel</span><span class="tok-o">(</span><span class="tok-no">HIDDEN</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">WS</span><span class="tok-w">       </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span> <span class="tok-err">\</span><span class="tok-n">t</span><span class="tok-err">\</span><span class="tok-n">r</span><span class="tok-p">]</span><span class="tok-o">+</span><span class="tok-w">     </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-nv">channel</span><span class="tok-o">(</span><span class="tok-no">HIDDEN</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// --------- keywords ----------</span><span class="tok-w"></span>

<span class="tok-nl">SYM_DEFINED</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;defined&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_SELF</span><span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;Self&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_IN</span><span class="tok-w">      </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;in&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_CHOICE</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;choice&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_CASE</span><span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;case&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SYM_RESULT</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;Result&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// --------- symbols ----------</span><span class="tok-w"></span>
<span class="tok-nl">SYM_ASSIGNMENT</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;:=&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_COLON</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;:&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_INTERROGATION</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;?&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_NE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;/=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;!=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;≠&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_EQ</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;=&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_GT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_LT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_LE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;≤&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_GE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;≥&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SYM_PLUS</span><span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;+&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_MINUS</span><span class="tok-w">   </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_TIMES</span><span class="tok-w">   </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;*&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_SLASH</span><span class="tok-w">   </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;/&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_PERCENT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;%&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_CARET</span><span class="tok-w">   </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;^&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_DOT</span><span class="tok-w">     </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SYM_DOUBLE_MINUS</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;--&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_DOUBLE_PLUS</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;++&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SYM_THEN</span><span class="tok-w">     </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;then&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;THEN&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_AND</span><span class="tok-w">      </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;and&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;AND&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;∧&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_OR</span><span class="tok-w">       </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;or&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;OR&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;∨&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_XOR</span><span class="tok-w">      </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;xor&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;XOR&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_NOT</span><span class="tok-w">      </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;not&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;NOT&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;!&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;~&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;¬&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_IMPLIES</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;implies&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;⇒&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;→&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_IFF</span><span class="tok-w">      </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;⇔&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;↔&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_FOR_ALL</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;for_all&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;∀&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_THERE_EXISTS</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;there_exists&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;∃&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_MATCHES</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;matches&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;is_in&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;∈&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">SYM_ASSERT</span><span class="tok-w">   </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;assert&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// TODO: replace with defined() and attached() predicates</span><span class="tok-w"></span>
<span class="tok-nl">SYM_EXISTS</span><span class="tok-w">   </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;exists&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">BOUND_VARIABLE_ID</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;$&#39;</span><span class="tok-w"> </span><span class="tok-no">LC_ID</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">// ---------- local code that are not ADL codes -------</span><span class="tok-w"></span>
<span class="tok-c">// e.g. [heart_rate]</span><span class="tok-w"></span>
<span class="tok-nl">LOCAL_TERM_CODE_REF</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;[&#39;</span><span class="tok-w"> </span><span class="tok-no">ALPHANUM_US_CHAR</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;]&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="anchor" href="#_references"></a>References</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a id="Hein2002"></a>Hein, J. L. (2002). <em>Discrete Structures, Logic and Computability</em> (Second.). Jones and Bartlett.</p>
</div>
<div class="paragraph">
<p><a id="Kilov1994"></a>Kilov, H., &amp; Ross, J. (1994). <em>Information Modelling - an object-oriented approach</em>. Prentice Hall.</p>
</div>
<div class="paragraph">
<p><a id="Sowa2000"></a>Sowa, J. F. (2000). <em>Knowledge Representation: Logical, philosophical and Computational Foundations</em>. California: Brooks/Cole.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-05-10 13:51:02 +0100
</div>
</div>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</body>
</html>